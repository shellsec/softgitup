# SoftGitUp 使用说明

## 系统概述

SoftGitUp 是一个跨平台的软件同步工具，包含两个主要组件：

1. **本地管理工具** (`soft_manager.py`) - 管理本地软件目录，生成索引文件
2. **后台同步工具** (`soft_sync.py`) - 后台运行，定时从GitHub同步更新

## 安装步骤

### 1. 安装Python依赖
```bash
pip install -r requirements.txt
```

### 2. 配置GitHub仓库
确保您的GitHub仓库地址正确配置在 `config.json` 中：
```json
{
    "github_repo": "https://github.com/shellsec/softgitup"
}
```

## 使用方法

### 本地管理工具

#### 功能说明
- 扫描本地软件目录
- 计算文件哈希值
- 生成软件列表文件 (`list.txt`)
- 自动提交到GitHub

#### 运行方式
```bash
# 方式1: 直接运行Python脚本
python soft_manager.py

# 方式2: 使用批处理文件
start_manager.bat

# 方式3: 使用快速开始脚本
快速开始.bat
```

#### 工作流程
1. 将软件文件放入对应的目录（如 `D:\Program Files\notepad++\`）
2. 运行管理工具
3. 工具自动扫描并生成 `list.txt`
4. 自动提交到GitHub仓库

### 后台同步工具

#### 功能说明
- 后台运行，系统托盘图标
- 定时同步（默认每天7点）
- 自动下载并覆盖本地文件
- 支持手动同步

#### 运行方式
```bash
# 方式1: 直接运行Python脚本
python soft_sync.py

# 方式2: 使用批处理文件
start_sync.bat

# 方式3: 使用快速开始脚本
快速开始.bat
```

#### 系统托盘功能
- **立即同步**: 手动触发同步操作
- **查看日志**: 打开同步日志文件
- **设置**: 查看当前配置
- **退出**: 关闭同步工具

## 目录结构

```
softgitup/
├── software/                 # 软件存放目录（开发环境）
│   ├── CCleaner/            # CCleaner 软件目录
│   ├── EditPlus/            # EditPlus 软件目录
│   ├── everything/          # Everything 软件目录
│   ├── HiBit Startup Manager/ # HiBit Startup Manager 软件目录
│   ├── notepad++/           # Notepad++ 软件目录
│   ├── notepad-/            # Notepad- 软件目录
│   ├── SublimeText/         # SublimeText 软件目录
│   ├── WinMemoryCleaner/    # WinMemoryCleaner 软件目录
│   └── WinRAR/              # WinRAR 软件目录
├── logs/                    # 日志目录
│   ├── manager.log          # 管理工具日志
│   └── sync.log             # 同步工具日志
├── dist/                    # 编译后的可执行文件目录
│   ├── SoftGitUp_Manager.exe # 管理工具可执行文件
│   └── SoftGitUp_Sync.exe   # 同步工具可执行文件
├── config.json              # 主配置文件
├── list.txt                 # 软件列表文件（自动生成）
├── soft_manager.py          # 本地管理工具源码
├── soft_sync.py             # 后台同步工具源码
├── build_exe.py             # 编译脚本
├── requirements.txt         # Python依赖
└── README.md               # 项目说明
```

## 配置文件说明

### config.json
```json
{
    "github_repo": "https://github.com/shellsec/softgitup",  // GitHub仓库地址
    "list_file": "list.txt",                                 // 列表文件名
    "sync_time": "07:00",                                    // 同步时间
    "software_dirs": {                                       // 软件目录配置
        "CCleaner": "CCleaner",
        "EditPlus": "EditPlus",
        "everything": "everything",
        "HiBit Startup Manager": "HiBit Startup Manager",
        "notepad++": "notepad++",
        "notepad-": "notepad-",
        "SublimeText": "SublimeText",
        "WinMemoryCleaner": "WinMemoryCleaner",
        "WinRAR": "WinRAR"
    },
    "local_base_path": "D:\\Program Files",                  // 本地软件路径
    "log_level": "INFO",                                     // 日志级别
    "auto_start": true,                                      // 自动启动
    "check_interval": 3600                                   // 检查间隔（秒）
}
```

## 编译成可执行文件

### 方法一：使用项目自带的编译脚本（推荐）

#### 1. 运行编译脚本
```bash
python build_exe.py
```

#### 2. 编译过程说明
- 自动安装PyInstaller（如果未安装）
- 编译管理工具和同步工具
- 生成单个可执行文件
- 包含配置文件

#### 3. 编译结果
编译完成后，可执行文件会生成在 `dist/` 目录中：
- `SoftGitUp_Manager.exe` - 管理工具（约20-30MB）
- `SoftGitUp_Sync.exe` - 同步工具（约20-30MB）

### 方法二：使用快速开始脚本

```bash
快速开始.bat
```
然后选择选项 "5. 打包成可执行文件"

### 方法三：手动使用PyInstaller

#### 1. 安装PyInstaller
```bash
pip install pyinstaller
```

#### 2. 编译同步工具
```bash
pyinstaller --onefile --windowed --name SoftGitUp_Sync --add-data "config.json;." soft_sync.py
```

#### 3. 编译管理工具
```bash
pyinstaller --onefile --windowed --name SoftGitUp_Manager --add-data "config.json;." soft_manager.py
```

### 方法四：优化编译（减小文件大小）

```bash
# 编译同步工具（排除不必要的模块）
pyinstaller --onefile --windowed --name SoftGitUp_Sync --add-data "config.json;." --exclude-module matplotlib --exclude-module numpy --exclude-module pandas soft_sync.py

# 编译管理工具（排除不必要的模块）
pyinstaller --onefile --windowed --name SoftGitUp_Manager --add-data "config.json;." --exclude-module matplotlib --exclude-module numpy --exclude-module pandas soft_manager.py
```

## 编译参数说明

- `--onefile`: 打包成单个可执行文件
- `--windowed`: 无控制台窗口（后台运行）
- `--name`: 指定输出文件名
- `--add-data`: 包含配置文件
- `--exclude-module`: 排除不需要的模块（减小文件大小）

## 使用编译后的文件

### 同步工具使用
```bash
# 直接运行
SoftGitUp_Sync.exe

# 或者双击运行
# 程序会在系统托盘显示图标
```

### 管理工具使用
```bash
# 直接运行
SoftGitUp_Manager.exe

# 或者双击运行
# 程序会显示操作进度
```

## 编译注意事项

### 1. 环境要求
- Python 3.7+ 已安装
- 所有依赖已安装：`pip install -r requirements.txt`
- 足够的磁盘空间（编译过程需要临时空间）

### 2. 编译检查清单
- [ ] 安装Python依赖：`pip install -r requirements.txt`
- [ ] 确认配置文件正确
- [ ] 运行编译脚本：`python build_exe.py`
- [ ] 检查 `dist/` 目录中的可执行文件
- [ ] 测试编译后的文件功能

### 3. 常见编译问题

#### 问题1：编译失败
**解决方案**：
```bash
# 清理临时文件
rmdir /s build
rmdir /s dist
del *.spec

# 重新编译
python build_exe.py
```

#### 问题2：文件过大
**解决方案**：
```bash
# 使用优化编译命令
pyinstaller --onefile --windowed --name SoftGitUp_Sync --add-data "config.json;." --exclude-module matplotlib --exclude-module numpy --exclude-module pandas --exclude-module scipy soft_sync.py
```

#### 问题3：杀毒软件误报
**解决方案**：
- 将编译目录添加到杀毒软件白名单
- 使用数字签名（高级用户）
- 提交误报反馈给杀毒软件厂商

#### 问题4：权限不足
**解决方案**：
- 以管理员身份运行命令提示符
- 确保有足够的磁盘空间和权限

### 4. 编译优化建议

#### 减小文件大小
```bash
# 排除大型库
--exclude-module matplotlib
--exclude-module numpy
--exclude-module pandas
--exclude-module scipy
--exclude-module PIL
```

#### 提高启动速度
```bash
# 使用UPX压缩（需要安装UPX）
--upx-dir "C:\path\to\upx"
```

#### 包含额外文件
```bash
# 包含其他必要文件
--add-data "config.json;."
--add-data "logs;logs"
```

## 常见问题

### Q: 如何修改同步时间？
A: 编辑 `config.json` 文件中的 `sync_time` 字段，格式为 "HH:MM"

### Q: 如何添加新的软件？
A: 在 `config.json` 的 `software_dirs` 中添加新条目，并在 `D:\Program Files` 目录下创建对应文件夹

### Q: 同步失败怎么办？
A: 检查网络连接，查看 `logs/sync.log` 日志文件获取详细错误信息

### Q: 如何查看同步状态？
A: 右键点击系统托盘图标，选择"查看日志"或"设置"

### Q: 编译后的文件无法运行？
A: 检查是否被杀毒软件拦截，尝试以管理员身份运行

### Q: 编译过程很慢？
A: 这是正常现象，PyInstaller需要打包Python运行时和所有依赖

## 注意事项

1. **首次使用**: 需要先运行管理工具生成初始的 `list.txt` 文件
2. **Git配置**: 确保本地Git已正确配置GitHub仓库
3. **网络要求**: 同步工具需要网络连接访问GitHub
4. **权限要求**: 确保程序有读写本地文件的权限
5. **防火墙**: 如果使用防火墙，请允许程序访问网络
6. **编译环境**: 建议在干净的环境中编译，避免依赖冲突
7. **文件分发**: 编译后的文件可以独立分发，不需要Python环境

## 技术支持

如遇到问题，请查看日志文件或联系技术支持。 